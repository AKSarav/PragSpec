---
status: ready
---

# Task Management

## Functional

### Why
Registered users need to create, organise, and track their personal tasks.
This is the core value of the product — without it, user management has no purpose.

### What

1. An authenticated user creates a task with a title, optional description, and optional due date.
2. The user can list all their tasks, optionally filtered by status.
3. The user can update any field of a task they own — title, description, due date, or status.
4. The user can delete a task they own.
5. A user can never see, modify, or delete another user's tasks.

**Acceptance criteria:**
- Creating a task with a valid title returns 201 with the full task object
- Creating a task without a title returns 400 with code `VALIDATION_ERROR`
- Listing tasks returns only the authenticated user's tasks, sorted by `createdAt` descending
- Listing with `?status=todo` (or `in_progress`, `done`) returns only tasks matching that status
- Updating a task the user owns with valid fields returns 200 with the updated task object
- Updating with invalid field values returns 400 with code `VALIDATION_ERROR`
- Attempting to update or delete a task owned by another user returns 404 (not 403 — no resource existence leak)
- Deleting a task the user owns returns 204
- All task endpoints return 401 if the JWT is missing or invalid

### Out of Scope
- Shared tasks or collaboration between users
- Task ordering / manual sorting
- Tags, labels, or categories
- Subtasks
- Attachments
- Pagination — all tasks returned in one response for v1
- Soft delete — deletion is permanent

---

## Technical

### Data Model

**`tasks` table**

| Column | Type | Notes |
|---|---|---|
| `id` | UUID | Primary key, generated by DB |
| `userId` | UUID | Foreign key → `users.id`, cascade delete |
| `title` | VARCHAR(500) | Required |
| `description` | TEXT | Optional, nullable |
| `status` | ENUM | `todo`, `in_progress`, `done` — default `todo` |
| `dueDate` | DATE | Optional, nullable, date only (no time component) |
| `createdAt` | TIMESTAMPTZ | Set by DB on insert |
| `updatedAt` | TIMESTAMPTZ | Updated by Prisma on every write |

**Status enum values:** `todo` | `in_progress` | `done`

**Cascade:** deleting a user cascades to delete all their tasks.

### API Contract

All task endpoints require `Authorization: Bearer <token>`.

---

#### `POST /v1/tasks` — Create task

**Request body (JSON):**
```json
{
  "title": "Buy groceries",
  "description": "Milk, eggs, bread",
  "dueDate": "2026-03-01"
}
```

**Validations:**
1. `title` — string, 1–500 characters, required
2. `description` — string, optional
3. `dueDate` — ISO 8601 date string (`YYYY-MM-DD`), optional; must not be in the past

**Response 201:**
```json
{
  "id": "c3d4e5f6-...",
  "title": "Buy groceries",
  "description": "Milk, eggs, bread",
  "status": "todo",
  "dueDate": "2026-03-01",
  "createdAt": "2026-02-20T10:00:00Z",
  "updatedAt": "2026-02-20T10:00:00Z"
}
```

---

#### `GET /v1/tasks` — List tasks

**Query params:**

| Param | Type | Required | Notes |
|---|---|---|---|
| `status` | string | No | One of `todo`, `in_progress`, `done`. Omit to return all. |

**Response 200:**
```json
[
  {
    "id": "c3d4e5f6-...",
    "title": "Buy groceries",
    "description": "Milk, eggs, bread",
    "status": "todo",
    "dueDate": "2026-03-01",
    "createdAt": "2026-02-20T10:00:00Z",
    "updatedAt": "2026-02-20T10:00:00Z"
  }
]
```

Sorted by `createdAt` descending. Returns an empty array `[]` if no tasks match.

---

#### `PATCH /v1/tasks/:id` — Update task

Partial update — only the fields provided in the body are changed.

**Request body (JSON, all fields optional):**
```json
{
  "title": "Buy groceries and coffee",
  "description": "Updated list",
  "status": "in_progress",
  "dueDate": "2026-03-05"
}
```

**Validations:** same rules as create, applied only to provided fields.

**Ownership check:** if a task with `id` exists but belongs to a different user, return 404 — not 403. Do not reveal that the resource exists.

**Response 200:** full updated task object (same shape as create response).

---

#### `DELETE /v1/tasks/:id` — Delete task

**Ownership check:** same as PATCH — return 404 if the task exists but belongs to another user.

**Response 204:** no body.

---

**Error codes used by this feature:**

| Code | Status | Trigger |
|---|---|---|
| `VALIDATION_ERROR` | 400 | Missing title, invalid status value, past due date |
| `UNAUTHORIZED` | 401 | Missing or invalid JWT |
| `TASK_NOT_FOUND` | 404 | Task doesn't exist or belongs to another user |

### Implementation Notes

- Every Prisma query on `tasks` must include `where: { id, userId: req.user.id }` — the service layer must enforce this, never the controller
- For PATCH, use Prisma's `update` with the result of a Zod `.partial()` schema — only pass fields that were explicitly provided in the request body, never `undefined` values
- `dueDate` is stored as a `Date` (date-only) in Prisma; serialize to `YYYY-MM-DD` string in the response — never include time or timezone offset for date-only fields
- The `status` filter on GET should be validated by Zod before hitting the DB; an invalid status value returns `VALIDATION_ERROR` (400), not a DB error

---

## Open Questions
_(none)_
